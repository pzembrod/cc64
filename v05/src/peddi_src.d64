\ SIMPLE FORTH TEXTFILE EDITOR 10SEP94PZ                                                                                   TESTLOAD         3                       PEDDI4CC64       4                       STANDALONE       5                       TEST3            6                       WHICHKEY         7                       LOGO             8                       SHELL            9                       FRAME          &12                       EDIT           &18                                                                                                         TESTINCLUDE   &150                                                                                                                                                                                                                                                                                                                                                                                                                                                \ MEMORY SETTINGS FOR CC64     14SEP94PZ                                            SAVE                                     $CBD0 SET-HIMEM                          $C000 ' LIMIT >BODY !                    0 INK-POT !  15 INK-POT 2+ C!            1024 1024 SET-STACKS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \ MEMORY SETTINGS STANDALONE   07MAY95PZ                                            SAVE                                                                            ‹ : RELOCATE-TASKS  ( NEW’– -- )          UP@ DUP ¬≈«…Œ  1+ UNDER @ 2DUP -         ◊»…Ã≈  ROT DROP  “≈–≈¡‘  2DROP ! ;                                               ‹ : RELOCATE  ( STACKLEN RSTACKLEN -- )   EMPTY  256 MAX 8192 MIN  SWAP            256 MAX 8192 MIN  PAD + 256 +            2DUP + 2+ LIMIT U>                       ABORT" STACKS BEYOND LIMIT"              UNDER  +   ORIGIN $¡ + !        \ R0     DUP RELOCATE-TASKS                       UP@ 1+ @   ORIGIN   1+ !        \ TASK         6 -  ORIGIN  8 + ! COLD ; \ S0                                               $CBD0 ' LIMIT >BODY !                    0 INK-POT !  15 INK-POT 2+ C!            256 256 RELOCATE                                                                                                                                                                                          \ PEDDI LOADSCREEN TEST        15SEP94PZ                                            : ‹ ;                                                                             ONLYFORTH  DECIMAL                       VOCABULARY PEDDI                         VOCABULARY SHELL                         PEDDI ALSO DEFINITIONS                                                             CREATE DEV#  8 C,                       : DEV  DEV# C@ ;                                                                \ : TEXT[   R0 @ ;                       \ ' LIMIT ¡Ã…¡” ]TEXT                    CREATE TEXT[ 4000 ALLOT                  HERE CONSTANT ]TEXT                        18 LOAD   \ EDITOR FUNCTIONS             12 LOAD   \ EDITOR FRAMEWORK           \\                                         SHELL ALSO DEFINITIONS                                                          ' ED ¡Ã…¡” ED                                                                       8 10 THRU  \ SHELL & SAVESYSTEM                                                \ PEDDI LOADSCREEN FOR CC64    07MAY95PZ                                            ONLYFORTH  DECIMAL                     ‹ VOCABULARY PEDDI                         COMPILER ALSO PEDDI ALSO DEFINITIONS                                            ‹ ' LOMEM    ALIAS TEXT[                 ‹ ' HIMEM    ALIAS ]TEXT                 ‹ ' DEV      ALIAS DEV                                                              ONLYFORTH PEDDI ALSO DEFINITIONS                                                  18 LOAD   \ EDITOR FUNCTIONS             12 LOAD   \ EDITOR FRAMEWORK                                                      SHELL ALSO DEFINITIONS                                                          ' ED ¡Ã…¡” ED                                                                        6 LOAD   \ COMBINED LOGO                                                          1 LOAD   \ SAVE & SET MEMORY                                                                                                                                    \ PEDDI LOADSCREEN STANDALONE  07MAY95PZ                                            ONLYFORTH  DECIMAL                     ‹ VOCABULARY PEDDI                         VOCABULARY SHELL                         PEDDI ALSO DEFINITIONS                                                          ‹  CREATE DEV#  8 C,                     ‹ : DEV  DEV# C@ ;                                                                ‹ : TEXT[   R0 @ ;                       ‹ ' LIMIT ¡Ã…¡” ]TEXT                                                               18 LOAD   \ EDITOR FUNCTIONS             12 LOAD   \ EDITOR FRAMEWORK                                                      SHELL ALSO DEFINITIONS                                                          ' ED ¡Ã…¡” ED                                                                     ' BYE ¡Ã…¡” BYE                                                                     7 10 THRU  \ SHELL & SAVESYSTEM          2 LOAD     \ SET MEMORY                                                        \   COMBINED LOGO              14APR20PZ                                          ‹ : .LOGO  ( -- )                           [ ' 'RESTART >BODY @ , ]                 ." PEDDI TEXT EDITOR ÷0.3 PRESENT"       CR ;                                                                           ' .LOGO …” 'RESTART                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \   SHELL: COLD' LOGO          14APR20PZ                                          ‹ CREATE CHARSET    HERE HERE 2- !          ALSO ASSEMBLER   HERE 6 +  $20 C, ,      XYŒEXT $4C C, ,  $CBFA     $6C C, ,      TOSS                                                                           \NEEDS 2@  ‹ : 2@  DUP 2+ @ SWAP @ ;                                              ‹ : INIT-SHELL  ( -- )                        ONLY SHELL                               $CBFC 2@  $65021103. D=                     …∆ CHARSET ‘»≈Œ ;                                                         ' INIT-SHELL …” 'COLD                                                             ‹ : .LOGO  ( -- )                             ."     RUNNING" CR                       ." PEDDI TEXT EDITOR ÷0.3" CR            ." 1995 BY –HILIP ⁄EMBROD" CR            $CBFC 2@  $65021103. D= NOT ?EXIT        ." √ CHARSET IN USE" CR ;                                                    ' .LOGO …” 'RESTART                                                              \   SHELL:                     03SEP94PZ                                          : DIR  ( -- )                               DEV 0 BUSOPEN  ASCII $ BUS! BUSOFF       DEV 0 BUSIN BUS@ BUS@ 2DROP              ¬≈«…Œ CR BUS@ BUS@ 2DROP                 I/O-STATUS? 0= ◊»…Ã≈                     BUS@ BUS@ 256 * + U.                     ¬≈«…Œ BUS@ ?DUP ◊»…Ã≈ CON! “≈–≈¡‘        “≈–≈¡‘ BUSOFF DEV 0 BUSCLOSE ;                                                 : DOS  ( -- )                               BL WORD COUNT ?DUP                          …∆  DEV 15 BUSOUT  BUSTYPE               BUSOFF  CR ≈Ã”≈ DROP ‘»≈Œ             DEV 15 BUSIN                             ¬≈«…Œ BUS@ CON! I/O-STATUS? ’Œ‘…Ã        BUSOFF ;                                                                       : CAT    ( -- )  CR                         DEV 2 BUSOPEN  BL WORD COUNT BUSTYPE     BUSOFF  DEV 2 BUSIN  ¬≈«…Œ BUS@ CON!     I/O-STATUS? ’Œ‘…Ã BUSOFF                 DEV 2 BUSCLOSE ;                                                              \   SHELL: COLD' LOGO          14APR20PZ                                            : DEVICE  ( N -- )                          DEV# C! ;                                                                      : DEVICE?  ( -- )                           ." ACTUAL DEVICE NUMBER IS "             DEV# C@ . ;                                                                    : HELP  ( -- )                              ." AVAILABLE COMMANDS:" CR WORDS ;                                           \\                                       ‹ : INIT-SHELL  ( -- )                        ONLY SHELL ;                                                                 ' INIT-SHELL …” 'COLD                                                             ‹ : .LOGO  ( -- )                             ."     RUNNING" CR                       ." PEDDI TEXT EDITOR ÷0.3" CR            ." 1995 BY –HILIP ⁄EMBROD" CR ;                                              ' .LOGO …” 'RESTART                                                              \ SAVESYSTEM                   07MAY95PZ                                          \NEEDS SAVESYSTEM (                      \\ )                                                                              ‹ : (SAVSYS ( ADR LEN -- )                [ ¡SSEMBLER ] ŒEXT  [ ∆ORTH ]            ['] PAUSE  DUP PUSH  !  \ SINGLETASK     I/O PUSH  I/O OFF  BUSTYPE ;                                                       : SAVEALL      \ NAME MUSS FOLGEN       SAVE  DEV 2 BUSOPEN  0 PARSE BUSTYPE     " ,P,W" COUNT BUSTYPE  BUSOFF            DEV 2 BUSOUT  ORIGIN $17 -               DUP  $100 U/MOD  SWAP BUS! BUS!          HERE OVER - (SAVSYS  BUSOFF              DEV 2 BUSCLOSE                           0 (DRV ! DERROR? ABORT" SAVE-ERROR" ;                                                                                                                                                                                                                                                                                                 \ ALLOCATE COMPILER            28AUG94PZ                                            ' LINEBUFFER ALIAS TEXT[                 ' HIMEM      ALIAS ]TEXT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ CORE LOADSCREEN              14SEP94PZ                                          ‹ : RESET  ( -- )                             $0287 @ $FC00 AND >R                     SCR> $3FF AND R@ OR                      [ ' SCR> >BODY ] LITERAL !               <SCR $3FF AND R@ OR                      [ ' <SCR >BODY ] LITERAL !               LAST-ROW> $3FF AND R> OR                 [ ' LAST-ROW> >BODY ] LITERAL !                                                   TEXT[ DUP 1ST-LINE> ! LINE> !            CHAR OFF  1.COLUMN OFF                   VIR-CHAR OFF                             #CR TEXT[ C!  #CR ]TEXT 1- C!            TEXT[ 1+ )TEXT !                         ]TEXT 1- TEXT( ! ;                                                                                                      1 3 +THRU                                                                                                                                                                                                                                          \   EDLOOP                     14SEP94PZ                                          \ 100 101 THRU                                                                    ‹ : EDLOOP ( -- )                             CREATE  64 0 ƒœ ' , Ãœœ–                DOES> ( PFA -- )                          >R  END? OFF                             ¬≈«…Œ KEY DUP $60 AND                       …∆ .CHAR                                 ≈Ã”≈ DUP $1F AND 2* SWAP $80             AND 2/ + R@ + @ EXECUTE ‘»≈Œ     \    CHECK-MEM                                END? @ ’Œ‘…Ã RDROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \   EDLOOP                     15SEP94PZ                                          ‹ EDLOOP EDIT-PAGE                                                                 .DEL-TO  .BOL     NOOP     QUIT-ED       .DEL-UNDER .EOL   NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     .SPLIT-LINE NOOP  NOOP          .DEL-LINE .DOWN   NOOP     .SCREEN       .DEL-LEFT NOOP    NOOP     SAVETEXT      EXIT-ED  NOOP     NOOP     NOOP          NOOP     .RIGHT   .DEL-FROM NOOP                                                  NOOP     NOOP     NOOP     NOOP          NOOP     .20UP    NOOP     NOOP          .20DOWN  NOOP     NOOP     NOOP          NOOP     .CR      NOOP     NOOP          NOOP     .UP      NOOP     .KILL-LINE    .INST-LINE NOOP   NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     .LEFT    NOOP     NOOP                                                   CR .( EDIT-PAGE OKAY ! ) CR                                                                                              \   ED                         14SEP94PZ                                          ‹ : ED  ( -- )                                BL WORD FILENAME /FILENAME MOVE          FILENAME C@ /FILENAME 1- UMIN            FILENAME C!                              RESET LOADTEXT EDIT-PAGE ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           2SEP94PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       02SEP94PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ VARIABLES & LOADSCREEN       14SEP94PZ                                          ‹ 17 CONSTANT /FILENAME                                                           ‹  VARIABLE 1.COLUMN                     ‹  VARIABLE CHAR                         ‹  VARIABLE VIR-CHAR                     ‹  VARIABLE BLANKLINES                   ‹  CREATE FILENAME  /FILENAME ALLOT      ‹  VARIABLE CHANGED?                     ‹  VARIABLE END?                                                                  ‹ VARIABLE 1ST-LINE>                     ‹ VARIABLE LINE>                         ‹ VARIABLE )TEXT                         ‹ VARIABLE TEXT(                         ‹ VARIABLE LAST-LINE>                                                             ‹ : CHAR>  LINE> @ CHAR @ + ;                                                                                                1 26 +THRU                                                                                                                                                       \   DISPLAY                    02AUG94PZ                                          \NEEDS CODE ASCII @ WORD DROP                                                     ÃABEL (CBM>SCR                            Œ 8 + STA $7∆ # AND $20 # CMP            √” ?[ $40 # CMP                             √” ?[ $1∆ # AND  Œ 8 + BIT                  0< ?[ $40 # ORA  ]?  ]?  RTS  ]?   ¡SCII . # LDA  RTS                                                               ‹ √ODE CBM>SCR  ( 8B1 -- 8B2 )            ”– ÿ) LDA  (CBM>SCR JSR  ”– ÿ) STA       ŒEXT JMP  END-CODE                                                               \\ @                                                                              ‹ CREATE CSTAB                              $80 C,  $00 C,  $40 C,  $20 C,           $C0 C,  $40 C,  $80 C,  $80 C,                                                 ‹ : CBM>SCR  ( 8B1 -- 8B2 )                   DUP $FF = …∆ DROP $5E EXIT ‘»≈Œ          DUP $E0 AND 2/ 2/ 2/ 2/ 2/               CSTAB + C@ - $FF AND ;             \   DISPLAY                    02SEP94PZ                                          ‹ : KEY ( -- C )                              ¬≈«…Œ PAUSE C64KEY? ’Œ‘…Ã GETKEY ;                                           ‹ 40   CONSTANT COL/SCR                  ‹ 1024 CONSTANT SCR>                     ‹ 1024 CONSTANT CHR/SCR                  ‹ 2024 CONSTANT <SCR                     ‹ 1984 CONSTANT LAST-ROW>                ‹ ' SCR> ¡Ã…¡” 1ST-ROW>                  ‹ 25   CONSTANT ROWS/SCR                                                          ‹ VARIABLE CSR.ROW>                      ‹ VARIABLE CSR.COL                                                                ‹ : COL/SCR*  2* 2* 2* DUP 2* 2* + ;     ‹ : TH-ROW>  ( N -- ADR )                     COL/SCR* SCR> + ;                                                            ‹ : CURSOR> ( -- ADR )                        CSR.ROW> @ CSR.COL @ + ;            ‹ : FLIP  ( -- ) $80 CURSOR> CTOGGLE ;                                                                                    \   DISPLAY                    02SEP94PZ                                          ‹ : (.LINE  ( LINE ROW -- )                   SWAP 1.COLUMN @ 0 ?ƒœ DUP C@ #CR =          …∆ DROP COL/SCR BL FILL                  ’ŒÃœœ– EXIT ‘»≈Œ  1+ Ãœœ–             ( ROW LINE ) OVER COL/SCR BOUNDS         ƒœ ( ROW LINE ) DUP C@ DUP #CR =            …∆ 2DROP COL/SCR + … ?ƒœ                 BL … C! Ãœœ– ’ŒÃœœ– EXIT ‘»≈Œ         CBM>SCR … C! 1+ Ãœœ– 2DROP ;                                                 ‹ $D020 CONSTANT BORDER                  ‹ : HALF  ( N - )                             BORDER C! PAUSE $80 0 ƒœ Ãœœ– ;                                              ‹ : WARN-SIGNAL ( -- )                        BORDER PUSH  0 HALF  1 HALF                           0 HALF  1 HALF ;                                                                                                                                                                                                                                                            \   DISPLAY                    02SEP94PZ \\  \NEEDS CODE  \\                      ‹ √ODE (>PREVLINE  ( LINE> -- LINE'> )      ”– )Y LDA  TAY  ”– X) LDA                TEXT( CMP 0= ?[ TEXT( 1+ CPY ]?          0= ?[ LINE> LDA  LINE> 1+ LDY         ÃABEL END  ”– X) STA  TYA  1 # LDY                  ”– )Y STA  ŒEXT JMP ]?           SEC  1 # SBC  CC ?[ DEY ]?               [[ TEXT( CMP  0= ?[ TEXT( 1+ CPY ]?      END BEQ                                  >TEXT[ CMP  0= ?[ >TEXT[ 1+ CPY ]?       END BEQ   SEC  1 # SBC  CC ?[ DEY ]?     Œ STA  Œ 1+ STY Œ X) LDA  #CR # CMP      0= ?]  CLC  1 # ADC  0= ?[ INY ]?        END JMP  END-CODE                     ‹ √ODE (>NEXTLINE  ( LINE> -- LINE'> )      ”– X) LDA Œ STA  ”– )Y LDA Œ 1+ STA      [[ Œ X) LDA  #CR # CMP  0<> ?[[          Œ WINC ]]?                               Œ 1+ LDY  Œ INC  0= ?[ INY ]?  Œ LDA     )TEXT CMP 0= ?[ )TEXT 1+ CPY ]?          0= ?[ TEXT( LDA  TEXT( 1+ LDY ]?         ”– X) STA  TYA  1 # LDY  ”– )Y STA       ŒEXT JMP  END-CODE                   \   DISPLAY                    02SEP94PZ                                          \NEEDS >PREVLINE (                       \\ )                                                                              ‹ : >PREVLINE  ( LINE> -- LINE'> )            DUP TEXT( @ =                               …∆ DROP LINE> @ EXIT ‘»≈Œ             1- ¬≈«…Œ DUP TEXT( @ = ?EXIT                      DUP TEXT[   = ?EXIT             1- DUP C@ #CR = ’Œ‘…Ã 1+ ;                                                   ‹ : >NEXTLINE  ( LINE> -- LINE'> )            ¬≈«…Œ DUP C@ #CR - ◊»…Ã≈ 1+ “≈–≈¡‘       1+ DUP )TEXT @ =                            …∆ DROP TEXT( @ ‘»≈Œ ;           \\                                       ‹ : >PREVLINE ( LINE> -- LINE'> )             DUP  >PREVLINE1                          SWAP (>PREVLINE  OVER -                     …∆ WARN-SIGNAL ‘»≈Œ ;            ‹ : >NEXTLINE ( LINE> -- LINE'> )             DUP  >NEXTLINE1                          SWAP (>NEXTLINE  OVER -                     …∆ WARN-SIGNAL ‘»≈Œ ;           \   DISPLAY                    31AUG94PZ                                          ‹ : SETCUR ( SCRLINE -- )                     CSR.ROW> !                               CHAR @ 1.COLUMN @ - CSR.COL !            FLIP ;                                                                       \ : .LINE ( -- )                         \    CSR.ROW> @  LINE> @ OVER            \    (.LINE SETCUR ;                                                              ‹ : .SCREEN ( -- )                            1ST-LINE> @   <SCR SCR>                  ƒœ DUP … (.LINE                          DUP LINE> @ = …∆ … SETCUR ‘»≈Œ           >NEXTLINE DUP ]TEXT 1- =                    …∆ >PREVLINE LAST-LINE> !                … COL/SCR +  <SCR OVER -                 DUP COL/SCR / BLANKLINES !               BL FILL ’ŒÃœœ– EXIT ‘»≈Œ              COL/SCR +Ãœœ–                            >PREVLINE LAST-LINE> !                   BLANKLINES OFF ;                                                                                                     \   DISPLAY                    31AUG94PZ                                          ‹ : SCROLL-RIGHT? ( --  FLAG )                CSR.COL @ 0= ;                                                               ‹ : SCROLL-LEFT? ( --  FLAG )                 CSR.COL @ COL/SCR 1- = ;                                                     ‹ 8 CONSTANT #TAB                                                                 ‹ : SCROLL-LEFT ( -- )                        #TAB 1.COLUMN +!    .SCREEN ;                                                ‹ : SCROLL-RIGHT ( -- )                       1.COLUMN @ #TAB UMIN                     NEGATE 1.COLUMN +!  .SCREEN ;                                                                                         ‹ : MEM?  ( N -- FLAG )                       )TEXT @ + TEXT( @ U>                     DUP …∆ WARN-SIGNAL ‘»≈Œ ;                                                                                                                                                                              \   DISPLAY                    14SEP94PZ                                          ‹ : .CHAR ( C -- )  VIR-CHAR OFF              1 MEM? ?EXIT   CHANGED? ON               SCROLL-LEFT? …∆ SCROLL-LEFT ‘»≈Œ         CHAR> DUP 1+  )TEXT @ 1+                 DUP )TEXT !   OVER - CMOVE>              DUP CHAR> C!  1 CHAR +!                  FLIP  CURSOR> DUP 1+                     COL/SCR CSR.COL @ - 1- CMOVE>            CBM>SCR  CURSOR> C!                      1 CSR.COL +!  FLIP ;                                                         ‹ : .LEFT  ( -- )   VIR-CHAR OFF              CHAR @ 0= ?EXIT                          SCROLL-RIGHT? …∆ SCROLL-RIGHT ‘»≈Œ       -1 CHAR +!                               FLIP -1 CSR.COL +! FLIP ;                                                    ‹ : .RIGHT  ( -- )  VIR-CHAR OFF              CHAR> 1+ )TEXT @ = ?EXIT                 SCROLL-LEFT? …∆ SCROLL-LEFT ‘»≈Œ         1 CHAR +!                                FLIP  1 CSR.COL +!  FLIP ;                                                  \   DISPLAY                    14SEP94PZ                                          ‹ : 1ST-LINE-UP ( -- )                        1ST-LINE> @ >PREVLINE                    1ST-LINE> ! ;                                                                ‹ : 1ST-LINE-DOWN ( -- )                      1ST-LINE> @ >NEXTLINE                    1ST-LINE> ! ;                                                                ‹ : LAST-LINE-UP ( -- )                       BLANKLINES @                                …∆ -1 BLANKLINES +!                      ≈Ã”≈ LAST-LINE> @                        >PREVLINE LAST-LINE> ! ‘»≈Œ ;                                             ‹ : LAST-LINE-DOWN ( -- )                     LAST-LINE> @ >NEXTLINE                   DUP ]TEXT 1- = …∆ 1 BLANKLINES +!                       DROP EXIT ‘»≈Œ            LAST-LINE> ! ;                                                                                                                                                                                         \   DISPLAY                    31AUG94PZ                                          ‹ : .VIR-LEFT  ( -- )                         )TEXT @ LINE> @ - 1- >R                  VIR-CHAR @ 0=                               …∆ CHAR @ R@ U>                             …∆ CHAR @ VIR-CHAR !                     ≈Ã”≈ RDROP EXIT ‘»≈Œ  ‘»≈Œ         VIR-CHAR @  DUP R> UMIN CHAR @ -         ?DUP 0= …∆ DROP EXIT ‘»≈Œ >R             R@ CHAR @ + DUP CHAR !                   OVER = 0= AND VIR-CHAR !                 R@ CSR.COL @ +  DUP COL/SCR <            SWAP -1 > AND                               …∆ FLIP R> CSR.COL +! FLIP               ≈Ã”≈ 1.COLUMN @ R> +                     DUP 0< …∆ CSR.COL +!                            1.COLUMN OFF                             ≈Ã”≈ 1.COLUMN ! ‘»≈Œ              .SCREEN ‘»≈Œ ;                                                                                                                                                                                                                               \   DISPLAY                    13SEP94PZ                                          ‹ : (DEL-LINE  ( LINE -- )                    DUP COL/SCR + UNDER                      <SCR SWAP - CMOVE                        LAST-ROW> COL/SCR BL FILL ;                                                  ‹ : LINE-UP  ( -- )                           TEXT( @  DUP LAST-LINE> @ = >R                    ( FROM )   DUP >NEXTLINE        DUP TEXT( !         OVER - >R            )TEXT @ ( FROM TO ) DUP LINE> !          DUP R@ + )TEXT !    R> CMOVE             R> …∆ LINE> @ LAST-LINE> ! ‘»≈Œ ;                                            ‹ : .DOWN ( -- )                              TEXT( @ 1+ ]TEXT = ?EXIT                 LINE-UP                                  FLIP  CSR.ROW> @ LAST-ROW> =                …∆ SCR> (DEL-LINE                        1ST-LINE-DOWN LAST-LINE-DOWN             LAST-LINE> @ LAST-ROW> (.LINE            ≈Ã”≈ COL/SCR CSR.ROW> +! ‘»≈Œ         FLIP  .VIR-LEFT ;                                                           \   DISPLAY                    13SEP94PZ                                          ‹ : (INST-LINE  ( LINE -- )                   DUP  DUP COL/SCR +                       <SCR OVER - CMOVE>                            COL/SCR BL FILL ;                                                       ‹ : LINE-DOWN  ( -- )                         LINE> @  DUP LAST-LINE> @ = >R                   )TEXT @ OVER - >R                TEXT( @ R@ -  DUP TEXT( !                R>  CMOVE>   LINE> @ DUP )TEXT !         >PREVLINE LINE> !                        R> …∆ TEXT( @ LAST-LINE> ! ‘»≈Œ ;                                            ‹ : .UP ( -- )                                LINE> @ TEXT[ = ?EXIT                    LINE-DOWN                                FLIP  CSR.ROW> @ SCR> =                     …∆ 1ST-LINE-UP LAST-LINE-UP              SCR> (INST-LINE                          1ST-LINE> @ SCR> (.LINE                  ≈Ã”≈ COL/SCR NEGATE                      CSR.ROW> +! ‘»≈Œ                      FLIP  .VIR-LEFT ;                  \   DISPLAY                    14SEP94PZ                                          ‹ : .DEL-FROM  ( -- )                         VIR-CHAR OFF  CHANGED? ON                CHAR> #CR OVER C!  1+ )TEXT !            CURSOR> COL/SCR CSR.COL @ -              BL FILL  FLIP ;                                                              ‹ : .DEL-TO  ( -- )                           VIR-CHAR OFF  CHANGED? ON                LINE> @ CHAR> OVER - BL FILL             CSR.ROW> @ CSR.COL @ BL FILL ;                                               ‹ : .DEL-LINE  ( -- )                         .DEL-TO .DEL-FROM ;                                                                                                                                                                                                                                                                                                                                                                                                                                          \   DISPLAY                    14SEP94PZ                                          ‹ : (SPLIT-MEM  ( -- )                        CHAR> )TEXT @ OVER -  OVER 1+ SWAP       CMOVE>  #CR CHAR> C!  1 )TEXT +!         CHAR> 1+ LINE> !  CHAR OFF ;                                                 ‹ : .SPLIT-LINE ( -- )  VIR-CHAR OFF          1 MEM? ?EXIT   CHANGED? ON               LINE> @ LAST-LINE> @ =  (SPLIT-MEM          …∆ CHAR> LAST-LINE> !                    BLANKLINES @                                …∆ -1 BLANKLINES +!                      ≈Ã”≈ 1ST-LINE-DOWN ‘»≈Œ               ≈Ã”≈ LAST-LINE-UP ‘»≈Œ                1.COLUMN @ …∆ 1.COLUMN OFF                          .SCREEN EXIT ‘»≈Œ             CURSOR> COL/SCR CSR.COL @ - BL FILL      CSR.COL OFF                              CSR.ROW> @ LAST-ROW> =                      …∆ 1ST-ROW> (DEL-LINE                    ≈Ã”≈ COL/SCR CSR.ROW> +!                 CSR.ROW> @ (INST-LINE ‘»≈Œ            LINE> @ CSR.ROW> @ (.LINE  FLIP ;                                           \   DISPLAY                    15SEP94PZ                                          ‹ : (JOIN-MEM  ( -- )                         LINE> @  DUP >PREVLINE >R                DUP R@ - 1- CHAR !                  ( LINE )    )TEXT @ OVER -   OVER 1-     ( LINE LEN LINE-1 ) SWAP CMOVE   ( -- )       -1 )TEXT +!   R> LINE> !  ;                                                  ‹ : (JOIN-1STLAST  ( N -- )                   0 CASE? …∆ LAST-LINE-DOWN EXIT ‘»≈Œ      2 CASE? …∆ TEXT( @ 1+ ]TEXT =                       …∆ LINE> @ LAST-LINE> !                  1 BLANKLINES +!                          ≈Ã”≈ TEXT( @                             LAST-LINE> ! ‘»≈Œ                     EXIT ‘»≈Œ                        1 =     …∆ LINE> @ 1ST-LINE> !                   EXIT ‘»≈Œ                        LINE> @ DUP 1ST-LINE> !                  LAST-LINE> ! 1 BLANKLINES +! ;                                                                                                                                                                         \   DISPLAY                    14SEP94PZ                                          ‹ : .JOIN-LINES  ( -- )  VIR-CHAR OFF         LINE> @ TEXT[ = ?EXIT                    CHANGED? ON                              LINE> @ 1ST-LINE>  @ =  1 AND            LINE> @ LAST-LINE> @ =  2 AND OR         (JOIN-MEM   (JOIN-1STLAST                CHAR @ 1.COLUMN @ -    ( CSR.COL )       DUP COL/SCR U<                              …∆ CSR.COL !                             CSR.ROW> @  1ST-ROW> -                      …∆ CSR.ROW> @ (DEL-LINE                  COL/SCR NEGATE CSR.ROW> +!               BLANKLINES @ 0=                             …∆ LAST-LINE> @ LAST-ROW>                (.LINE ‘»≈Œ                           ‘»≈Œ                                  LINE> @ CSR.ROW> @ (.LINE FLIP           ≈Ã”≈ COL/SCR - #TAB +                    1.COLUMN +! .SCREEN ‘»≈Œ ;                                                                                                                                                                          \   DISPLAY                    14SEP94PZ                                          ‹ : .DEL-UNDER  ( -- )  VIR-CHAR OFF          CHAR> C@ #CR = ?EXIT                     CHANGED? ON                              CHAR> DUP 1+ SWAP )TEXT @ 1-             DUP )TEXT !  OVER - CMOVE                CURSOR> DUP 1+ SWAP                      COL/SCR CSR.COL @ - 1- CMOVE             LINE> @ 1.COLUMN @ + COL/SCR + 1-        DUP )TEXT @ 1- U<                           …∆ C@ ≈Ã”≈ DROP BL ‘»≈Œ CBM>SCR       CSR.ROW> @ COL/SCR + 1- C!               FLIP ;                                                                       ‹ : .DEL-LEFT  ( -- )                         CSR.COL @                                   …∆ .LEFT .DEL-UNDER                      ≈Ã”≈ .JOIN-LINES ‘»≈Œ  ;                                                                                                                                                                                                                                                              \   FOLD/UNFOLD                31AUG94PZ                                          ‹ : UNFOLD  ( -- )                            CHAR OFF  1.COLUMN OFF                   TEXT[ DUP 1ST-LINE> ! DUP LINE> !        >NEXTLINE DUP TEXT( @ =                     …∆ DROP EXIT ‘»≈Œ   ( FROM )          )TEXT @ OVER - >R  DUP )TEXT !           TEXT( @ R@ -       DUP TEXT( !           R> CMOVE> ;                                                                  \\                                                                                ‹ : FOLD  ( -- )                              TEXT( @  ]TEXT 1- OVER -                 ?DUP 0= …∆ DROP EXIT ‘»≈Œ                )TEXT @ SWAP   DUP )TEXT +!              CMOVE   ]TEXT 1- TEXT( ! ;                                                                                                                                                                                                                                                                                                        \   LOADTEXT                   07MAY95PZ                                          ‹ : (LOADTEXT  ( -- )                         #CR  ]TEXT 1-  DUP TEXT( !               DUP 1- )TEXT !  C!                       ]TEXT 2- TEXT[ ƒœ I/O-STATUS?               …∆ … )TEXT ! Ã≈¡÷≈ ‘»≈Œ               BUS@ … C! Ãœœ–                           )TEXT @ DUP 1- C@ #CR =                     …∆ DROP ≈Ã”≈ #CR OVER C!                 1+ )TEXT ! ‘»≈Œ  1 MEM? DROP ;                                            ‹ : LOADTEXT  ( -- )                          DEV 2 BUSOPEN                            FILENAME COUNT BUSTYPE                   " ,S,R"  COUNT BUSTYPE BUSOFF            PAGE  DERROR?                               …∆ DEV 2 BUSCLOSE                        CHANGED? OFF  .SCREEN                    EXIT ‘»≈Œ                             DEV 2 BUSIN  (LOADTEXT  BUSOFF           DEV 2 BUSCLOSE                           CHANGED? OFF  UNFOLD  .SCREEN ;                                                                                      \   SAVESYSTEM                 07MAY95PZ                                          ‹ : (SAVETEXT  ( -- FLAG )                    CR ." WRITING " FILENAME                 COUNT TYPE CR CR                         DEV 15 BUSOUT " S0:/" COUNT              BUSTYPE FILENAME COUNT BUSTYPE           BUSOFF  DEV 15 BUSOUT " R0:/"            COUNT BUSTYPE FILENAME COUNT 2DUP        BUSTYPE ASCII =  BUS! BUSTYPE            BUSOFF   \ DERROR? ?DUP ?EXIT            DEV 2 BUSOPEN FILENAME COUNT             BUSTYPE " ,S,W" COUNT BUSTYPE            BUSOFF  DEV 2 BUSOUT                     TEXT[   )TEXT @  OVER - BUSTYPE          TEXT( @ ]TEXT 1- OVER - BUSTYPE          DEV 2 BUSCLOSE  DERROR? ;                                                    ‹ : SAVETEXT  ( -- )                          PAGE (SAVETEXT                              …∆ ." WRITE OPERATION FAILED"            CR KEY DROP                              ≈Ã”≈ CHANGED? OFF ‘»≈Œ                .SCREEN ;                                                                   \   DISPLAY                    31AUG94PZ                                          ‹ : .BOL  ( -- )                              CHAR OFF  VIR-CHAR OFF  1.COLUMN @          …∆ 1.COLUMN OFF .SCREEN                  ≈Ã”≈ FLIP CSR.COL OFF FLIP               ‘»≈Œ ;                                                                    ‹ : .EOL  ( -- )                              VIR-CHAR OFF                             )TEXT @ 1- CHAR> - DUP >R  CHAR +!       CSR.COL @ R@ + COL/SCR - DUP 0<             …∆ DROP FLIP R> CSR.COL +! FLIP          ≈Ã”≈ 1+ 1.COLUMN +!                      RDROP .SCREEN ‘»≈Œ ;                                                      ‹ : .CR  ( -- )                               .BOL .DOWN ;                                                                                                                                                                                                                                                                                                                      \   EXIT                       14SEP94PZ                                          ‹ : (QUIT-ED  ( -- )  CR                 ." DO YOU WANT TO QUIT WITHOUT SAVING ?"      KEY ASCII Y = DUP END? !                 0= …∆ .SCREEN ‘»≈Œ ;                                                         ‹ : QUIT-ED  ( -- )                           PAGE  CHANGED? @                            …∆ (QUIT-ED ≈Ã”≈ END? ON ‘»≈Œ ;                                           ‹ : EXIT-ED  ( -- )                           PAGE  CHANGED? @                            …∆ (SAVETEXT                                …∆ (QUIT-ED EXIT ‘»≈Œ ‘»≈Œ         END? ON ;                                                                                                                                                                                                                                                                                                                                                                                                           \   INST/DELLINE               15SEP94PZ                                          ‹ : .KILL-LINE ( -- )                         VIR-CHAR OFF                             TEXT( @ 1+ ]TEXT = ?EXIT                 CHANGED? ON                              LAST-LINE-DOWN                           LINE> @ )TEXT ! LINE-UP                  CSR.ROW> @  (DEL-LINE                    BLANKLINES @ 0=                            …∆ LAST-LINE> @ LAST-ROW>                (.LINE ‘»≈Œ                            FLIP  .VIR-LEFT ;                                                            ‹ : .INST-LINE ( -- )                         VIR-CHAR OFF   1 MEM? ?EXIT              CHANGED? ON                              LAST-LINE> @ LINE> @ =                      …∆ 1 LAST-LINE> +! ‘»≈Œ               CHAR @ CHAR OFF (SPLIT-MEM CHAR !        LINE-DOWN  LAST-LINE-UP                  FLIP  CSR.ROW> @ (INST-LINE              FLIP  .VIR-LEFT ;                                                                                                    \   FAST UP/DOWN               15SEP94PZ                                          ‹ : N>PREVLINE  ( LINE +N -- LINE' )          0 ƒœ DUP TEXT[ =                            …∆ ’ŒÃœœ– EXIT ‘»≈Œ                   >PREVLINE Ãœœ– ;                                                             ‹ : N>NEXTLINE  ( LINE +N -- LINE' )          0 ƒœ DUP >NEXTLINE  DUP 1+ ]TEXT =          …∆ DROP ’ŒÃœœ– EXIT ‘»≈Œ              NIP Ãœœ– ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \   FAST UP/DOWN               15SEP94PZ                                          ‹ : N-LINE-DOWN  ( +N -- )                    LINE> @ TEXT[ = …∆ DROP EXIT ‘»≈Œ        LINE> @ SWAP N>PREVLINE                  DUP LINE> ! >NEXTLINE                    )TEXT @ OVER - >R  DUP )TEXT !           TEXT( @ R@ - DUP TEXT( !                 R> CMOVE> ;                                                                  ‹ : N-LINE-UP  ( +N -- )                      TEXT( @ DUP ROT N>NEXTLINE               2DUP = …∆ 2DROP EXIT ‘»≈Œ                OVER - >R  )TEXT @  R@ CMOVE             R@ )TEXT +!  R> TEXT( +!                 )TEXT @ >PREVLINE LINE> ! ;                                                                                                                                                                                                                                                                                                                                                                                         \   FAST UP/DOWN               15SEP94PZ                                          ‹ : .20UP  ( -- )                             1ST-LINE> @ 20 N>PREVLINE                1ST-LINE> !  20 N-LINE-DOWN              CHAR OFF  .SCREEN ;                                                          ‹ : .20DOWN  ( -- )                           20 N-LINE-UP                             1ST-LINE> @ 20 N>NEXTLINE                1ST-LINE> !                              CHAR OFF  .SCREEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \   EDIT PAGE                  20FEB92PZ                                          ‹ : LINE-UP ( -- )                            )TEXT @ DUP LINE> !                      TEXT( @ UNDER                            COUNT UNDER + 1+ TEXT( !                 2+ 2DUP + )TEXT ! CMOVE ;                                                    ‹ : DOWN ( -- )                               END-OF-PAGE? ?EXIT                       FOLD-LINE LINE-UP .DOWN ;                                                    ‹ : SCROLLUP ( -- )                           END-OF-PAGE? ?EXIT                       FOLD-LINE LINE-UP .SCROLL-UP ;                                                                                                                                                                                                                                                                                                                                                                                                                               \   EDIT PAGE                  12APR92PZ                                          ‹ : DELTA-CHAR ( -- N )                       LINE> @ 1+  CHAR @  UNDER                -TRAILING NIP - NEGATE 2+ ;                                                  ‹ : LEN(REST) ( -- N )                        LINE> @ C@ CHAR @ - ;                                                        ‹ : SPLITLINE ( -- )                          FOLD-LINE  2 MEM? ?EXIT                  LEN(REST) >R  CHAR>                      DELTA-CHAR DUP )TEXT +! CHAR +!          CHAR> R@ MOVE                            R@ CHAR> 1- C!  R> )TEXT @ 1- C!         CHAR @ 2- DUP  LINE> @ C!                CHAR> 1-  DUP LINE> !  1- C!             CHAR OFF                                 .DEL-FROM .DOWN .INST-LINE               1.COLUMN @                                  …∆ 1.COLUMN OFF  .SCREEN                 ≈Ã”≈ .CR .LINE ‘»≈Œ                   CHANGED! ;                                                                                                           \   EDIT PAGE                  12APR92PZ                                          ‹ : CONCATLINES ( -- )                        BEGIN-OF-PAGE? ?EXIT  FOLD-LINE          LINE> @ DUP C@ >R DUP 1- C@              DUP CHAR !  2+ NEGATE LINE> +!           1+ DUP 2- R@ CMOVE                       R> CHAR @ + DUP                          )TEXT @ 2- DUP )TEXT !  1- C!            LINE> @ C!                               .DEL-LINE .UP                            CHAR @ 1.COLUMN @ - COL/SCR U<              …∆ .LINE                                 ≈Ã”≈ CHAR @ COL/SCR 2/ -                 1.COLUMN !  .SCREEN ‘»≈Œ              CHANGED! ;                                                                   ‹ : DELLEFT' ( -- )                           CHAR @                                      …∆ DELLEFT                               ≈Ã”≈ CONCATLINES ‘»≈Œ ;                                                                                                                                                                             \   EDIT PAGE                  12APR92PZ                                          ‹ : CREATELINE.AFTER ( -- )                   TEXT( @ 2- DUP OFF TEXT( ! ;                                                 ‹ : CREATELINE.BEFORE ( -- )                  LINE> @  DUP  DUP 2+  DUP LINE> !        )TEXT @ 2+  DUP )TEXT !                  OVER - CMOVE>  OFF ;                                                         ‹ : INSTLINE ( -- )                           FOLD-LINE  2 MEM? ?EXIT                  CREATELINE.BEFORE LINE-DOWN              .INST-LINE  CHANGED! ;                                                       ‹ : NEXTLINE ( -- )                           FOLD-LINE  END-OF-PAGE?                     …∆ 2 MEM? ?EXIT                          CREATELINE.AFTER ‘»≈Œ                 LINE-UP .DOWN                            CHAR OFF  1.COLUMN @                        …∆ 1.COLUMN OFF  .SCREEN                 ≈Ã”≈ .CR ‘»≈Œ                         CHANGED! ;                                                                  \   EDIT PAGE                  12APR92PZ                                          ‹ : CLEARLINE ( -- )                          LINE> @ DUP OFF 2+ )TEXT !               .CLEAR-LINE  CHANGED! ;                                                      ‹ : DELLINE ( -- )                            END-OF-PAGE?                                …∆ CLEARLINE                             ≈Ã”≈ FOLD-LINE                           LINE> @ )TEXT !  LINE-UP                 .DEL-LINE ‘»≈Œ                        CHANGED! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \   EDIT PAGE: PROTOTYP        19APR92PZ                                          ‹ : HOME-PAGE ( -- )                          LINE> @ PAGE[ @ =                           …∆ HOME-LINE                             ≈Ã”≈ UNSPLITTEXT                         CHAR OFF  1.COLUMN OFF                   PAGE[ @ DUP 1ST-LINE> !                  DUP LINE> !  COUNT + 1+                  DUP )TEXT !  TEXT( !                     SPLITTEXT .SCREEN ‘»≈Œ ;                                                  ‹ : END-PAGE ( -- )                           TEXT( @ ]PAGE @ = BLANKLINES @ 0=       AND …∆ HOME-LINE                             ≈Ã”≈ UNSPLITTEXT                         CHAR OFF  1.COLUMN OFF                   ]PAGE @ DUP TEXT( ! DUP )TEXT !          1- COUNT - 2- DUP LINE> !                ROWS/SCR 1- 0                            ?ƒœ DUP PAGE[ @ = …∆ Ã≈¡÷≈ ‘»≈Œ          1- COUNT - 2- Ãœœ– 1ST-LINE> !           SPLITTEXT .SCREEN ‘»≈Œ ;                                                                                          KKKK\ FEATURES …                   15APR92PZ                                            1 8 +THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \   FEATURES …                 15APR92PZ                                          ‹ : INSERT-STRING ( ADR +N )                  BOUNDS ?ƒœ … C@ PUTCHAR Ãœœ– ;                                               ‹ : DEL-STRING ( +N )                         0 ƒœ DELUNDER Ãœœ– ;                                                                                                  \ : STRNCPY ( SRC DST MAXLEN -- )        \    ROT COUNT ROT UMIN ROT 2DUP >R >R   \    1+ SWAP MOVE R> R> C! ;                                                      \    >R OVER C@ R> UMIN 2DUP >R >R       \    1+ MOVE R> R> SWAP C! ;                                                      ‹ : STRCPY ( SRC DST -- )                     OVER C@ 1+ MOVE ;                                                            ‹ : MEMCAT                                ( DST DLEN SRC SLEN -- DST DLEN+SLEN )       >R >R 2DUP + R> SWAP R@ MOVE             R> + ;                                                                                                               \   FEATURES …                 17APR92PZ                                          ‹ CREATE (1MSG 1 ALLOT                                                            ‹ : .1CHARMSG ( C -- )                        (1MSG C! (1MSG 1 .MSG ;                                                                                               ‹ : SWITCH2TEXT# ( N -- )                     UNSPLITTEXT TEXT#!                       TEXT[ @ ]TEXT @ =                        SPLITTEXT  …∆ CLEARTEXT ‘»≈Œ             .SCREEN ;                                                                    ‹ : SWITCHTEXT ( -- )                         " GOTO TEXT NO. ?" COUNT .MSG            KEY ASCII 0 -                            DUP 1 #TEXTS UWITHIN                        …∆ DUP SWITCH2TEXT#  ASCII 0 +           ≈Ã”≈ DROP ASCII ? ‘»≈Œ                .1CHARMSG ;                                                                                                                                                                                            \   FEATURES …                 12APR92PZ                                          ‹ : LINECPY ( SRC DST -- )                    OVER C@ 2+ MOVE ;                                                            ‹ : (COPYLINE ( -- )                          LINE> @ DUP  C@ 2+ NEGATE                TEXT( LINESTACK> MOVETEXTS               LINESTACK> @ LINECPY ;                                                       ‹ : COPYLINE ( -- )                           257 MEM? ?EXIT                           (COPYLINE DOWN ;                                                             ‹ : CUTLINE ( -- )                            0 MEM? ?EXIT                             (COPYLINE DELLINE ;                                                                                                                                                                                                                                                                                                                                                        \   FEATURES …                 12APR92PZ                                          ‹ : PASTELINE ( -- )                          LINESTACK> @ CHARSTACK[ @ =                 …∆ WARN-SIGNAL EXIT ‘»≈Œ              0 MEM? ?EXIT  INSTLINE                   LINESTACK> @ DUP C@ >R                   LINE> @ LINECPY  R@ )TEXT +!             R> 2+ TEXT( LINESTACK> MOVETEXTS         .LINE ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \   FEATURES …                 16APR92PZ                                          ‹ 40 CONSTANT ALLOT-UNIT                                                          ‹ : (COPYCHAR ( -- )                          CHARSTACK[ @ CHARSTACK> @ =                 …∆ ALLOT-UNIT NEGATE                     TEXT( CHARSTACK[ MOVETEXTS ‘»≈Œ       CHAR @ LINE> @ C@ U<                        …∆ CHAR> C@ ≈Ã”≈ BL ‘»≈Œ              CHARSTACK> @ 1- DUP CHARSTACK> !         C! ;                                                                         ‹ : COPYCHAR ( -- )                           ALLOT-UNIT MEM? ?EXIT                    (COPYCHAR RIGHT ;                                                            ‹ : CUTCHAR ( -- )                            ALLOT-UNIT MEM? ?EXIT                    (COPYCHAR DELUNDER ;                                                                                                                                                                                                                            \   FEATURES …                 12APR92PZ                                          ‹ : PASTECHAR ( -- )                          CHARSTACK> @ ]EDIT =                        …∆ WARN-SIGNAL EXIT ‘»≈Œ              1 MEM? ?EXIT                             INSERT? PUSH  INSERT? ON                 CHARSTACK> @ DUP 1+ CHARSTACK> !         C@ PUTCHAR LEFT                          CHARSTACK> @ CHARSTACK[ @ -              CHARSTACK> @ ]EDIT XOR                      …∆ ALLOT-UNIT 2* U< 0=                   ALLOT-UNIT AND ‘»≈Œ                   ?DUP                                        …∆ TEXT( CHARSTACK[ MOVETEXTS            ‘»≈Œ ;                                                                                                                                                                                                                                                                                                                                                                                                           \   FEATURES …                 17APR92PZ                                          ‹ VARIABLE (CANCEL (CANCEL OFF           ‹ : CANCEL ( -- )   (CANCEL ON  END! ;   ‹ : .CANCEL  " CANCELLED" COUNT .MSG ;   ‹ : CANCELLED? ( -- FLAG )                    (CANCEL @  (CANCEL OFF                   DUP …∆ .CANCEL ‘»≈Œ ;                                                        ‹ : STRMEMCAT ( ADR LEN STR -- ADR L' )       COUNT MEMCAT ;                                                               ‹ : PROCEED? ( ADR LEN -- FLAG )              " PROCEED ? (Y/N)" STRMEMCAT .MSG        KEY ASCII Y = DUP 0=                        …∆ .CANCEL ‘»≈Œ ;                                                         ‹ : UNSAVED? ( -- FLAG )                      CHANGED? @ DUP                              …∆ DROP  PAD 0                           " CHANGES NOT SAVED! "                   STRMEMCAT PROCEED? 0= ‘»≈Œ ;                                                                                                                               \   FEATURES …                 18APR92PZ                                          ‹ : .LOGO ( -- )                              " PEDDI V1.0" COUNT .MSG ;                                                   ‹ : KILLTEXT ( -- )                           PAD 0 " KILL TEXT: " STRMEMCAT           PROCEED?                                    …∆ CLEARTEXT .LOGO .SCREEN               ‘»≈Œ ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \   FEATURES …                 17APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   FEATURES …                 12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   FEATURES …                 12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   STUFF                      12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   STUFF                      12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   STUFF                      12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \   STUFF                      12APR92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        KKKKKKKKKKKKKKKK\ FEATURES ……                  19APR92PZ                                           1 12 +THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \   FEATURES ……                15APR92PZ                                          ‹ EDLOOP EDIT-LINE                                                                 COPYCHAR NOOP     NOOP     NOOP          DELUNDER NOOP     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     END!     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          DELLEFT  NOOP     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     RIGHT    NOOP     NOOP                                                   NOOP     NOOP     NOOP     NOOP          NOOP     NOOP     NOOP      PASTECHAR    NOOP     NOOP     NOOP     CUTCHAR       NOOP     CANCEL   NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          +-INST   NOOP     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     LEFT     NOOP     NOOP                                                   CR .( EDIT-LINE OKAY ! ) CR                                                                                              \   FEATURES ……                12APR92PZ                                          ‹ : EDIT-STRING ( ADR MAXLEN -- )             2ND-SCREEN  TEXT#@ >R                    UNSPLITTEXT 0 TEXT#! SPLITTEXT           .SCREEN OVER COUNT INSERT-STRING         EDIT-LINE                                LINE> @ COUNT ROT UMIN ROT 2DUP C!       1+ SWAP CMOVE  CLEARTEXT                 UNSPLITTEXT R> TEXT#! SPLITTEXT          1ST-SCREEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \   FEATURES ……                17APR92PZ                                          ‹ : CR=    C@   $0D = ;                  ‹ : LF=    C@   $0A = ;                  ‹ : CRLF=   @ $0A0D = ; \ LO/HI-¬YTE IM  ‹ : LFCR=   @ $0D0A = ; \ …NTEL-∆ORMAT                                            ‹ CREATE EOL-CFA                            ' CR= , ' LF= , ' CRLF= , ' LFCR= ,   ‹ CREATE EOL-SEQ                            $0D ,  $0A ,  $0A0D ,  $0D0A ,        ‹ CREATE EOL-LEN                            1 C, 1 C, 2 C, 2 C,                   ‹ CREATE EOL-NAME                           ," CR" ," LF"                            ," CRLF" ," LFCR"                                                              ‹ DEFER EOL=                             ‹ VARIABLE EOL                           ‹ VARIABLE /EOL                                                                                                                                                                                                                                      \   FEATURES ……                17APR92PZ                                          ‹ VARIABLE EOL#  EOL# OFF                                                         ‹ : .EOL-NAME ( -- )                          PAD 0 " EOL:" STRMEMCAT                  EOL-NAME  EOL# @ 3 AND  0                ?ƒœ COUNT + Ãœœ– STRMEMCAT .MSG ;                                            ‹ : SET-EOL ( -- )                            EOL# @ 3 AND                                DUP EOL-LEN + C@ /EOL !               2* DUP EOL-CFA + @ …” EOL=                      EOL-SEQ + @ EOL ! ;                                                   ‹ : SWITCH-EOL ( -- )                         1 EOL# +!  SET-EOL  .EOL-NAME ;                                                                                                                                                                                                                                                                                                                                            \   FEATURES ……                12APR92PZ                                          ‹ : CHR, ( ADR C -- ADR+1 )                   OVER C! 1+ ;                                                                 ‹ : BREAK-LINE ( N1 N2 -- N3 N4 )             UNDER OVER - 1-                          UNDER SWAP C!  CHR, DUP 1+ ;                                                 ( /???/...ASCII-TEXT.../                     ^ - N1              ^ - N2                         ---                          /LEN/...ASCII-TEXT.../LEN/???/                                 N3 - ^  ^ - N4 )                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \   FEATURES ……                12APR92PZ                                          ‹ : ASCII>LIST ( -- )                         PAGE[ @ )TEXT @ 2DUP ]PAGE @             SWAP - + >R  OVER - R@ SWAP CMOVE>       PAGE[ @ DUP 1+                           ]PAGE @ /EOL @ - 1+ R>                   ƒœ … EOL=                                   …∆ BREAK-LINE  /EOL @                    ≈Ã”≈ 2DUP - -255 <                          …∆ BREAK-LINE  /EOL @                    " SPLIT LONG LINE" COUNT .MSG            ≈Ã”≈ … C@ CHR,  1 ‘»≈Œ ‘»≈Œ        +Ãœœ–                                    2DUP 1- - …∆ BREAK-LINE ‘»≈Œ DROP        DUP )TEXT ! 1- COUNT - 2-                DUP LINE> !  1ST-LINE> !                 CHAR OFF  ]PAGE @ TEXT( ! ;                                                                                                                                                                                                                                                                                                       \   FEATURES ……                17APR92PZ                                          ‹ : (.FILENAME ( STR -- )                     PAD 0 ROT STRMEMCAT                      "  FILENAME ?" STRMEMCAT .MSG ;                                              ‹ : GETFILENAME  ( STR -- NAME )              (.FILENAME                               FILENAME PAD STRCPY                      PAD /FILENAME EDIT-STRING                DUP C@ 0=  CANCELLED?  OR                   …∆ RDROP EXIT ‘»≈Œ                    FILENAME C@ 0=                              …∆ PAD FILENAME STRCPY ‘»≈Œ           PAD ;                                                                        ‹ : RENAMEFILE  ( -- )                        " NEW" (.FILENAME                        FILENAME /FILENAME EDIT-STRING ;                                                                                                                                                                                                                                                         \   FEATURES ……                19APR92PZ                                          ‹ ASCII , CONSTANT ','                                                            ‹ : CHECKTYPESPEC ( ADR L -- ADR' L' )        ?DUP …∆ OVER 1+ C@ ASCII @ U>                    …∆ $FFFF0001. D+ ',' SCAN                ‘»≈Œ ‘»≈Œ ;                                                          ‹ : SETLENGTH ( STR X L -- STR X L )          2 PICK C@ OVER - 3 PICK C! ;                                                 ‹ : SCANFILENAME                             ( NAME[,GA[,SA]] -- NAME GA SA )          DUP COUNT  2DUP + 0 SWAP C!              ',' SCAN  CHECKTYPESPEC  SETLENGTH       0= …∆ DROP 8 2 EXIT ‘»≈Œ                 0 0 ROT CONVERT NIP                      DUP C@ ',' -                                …∆ DROP 2 EXIT ‘»≈Œ                   0 0 ROT CONVERT 2DROP ;                                                                                                                                                                                \   FEATURES ……                19APR92PZ                                          ‹ 2VARIABLE FADDR                                                                 ‹ : DERROR? ( -- FLAG )                       2ND-SCREEN .CLS                          FADDR 2@ DROP 15 BUSIN                   BUS@ DUP ASCII 0 - SWAP                  ¬≈«…Œ .CHAR BUS@ I/O-STATUS? ’Œ‘…Ã       DROP BUSOFF 1ST-SCREEN ;                                                     ‹ : FILEOPEN ( NAME GA SA R/W -- )            >R                                       BUSOPEN COUNT 2DUP BUSTYPE               + 2- C@ ',' -                               …∆ ',' BUS! ASCII S BUS! ‘»≈Œ         ',' BUS! R> BUS! BUSOFF ;                                                                                                                                                                                                                                                                                                                                                  \   FEATURES ……                18APR92PZ                                          ‹ : READASCII ( NAME -- )                     CLEARTEXT                                SCANFILENAME 2DUP FADDR 2!               BUSOPEN COUNT BUSTYPE                    " ,S,R" COUNT BUSTYPE BUSOFF             DERROR? ?EXIT                            FADDR 2@ BUSIN                           PAGE[ @ ]PAGE @ OVER - MIN.FREE -        BUSREAD                                     …∆ )TEXT !                               ≈Ã”≈ ]TEXT @ MIN.FREE - )TEXT !          " MEMORY FULL" COUNT .MSG ‘»≈Œ        BUSOFF  FADDR 2@ BUSCLOSE                DERROR? DROP ;                                                               ‹ : READTEXT ( -- )                           UNSAVED? ?EXIT                           " READ:" GETFILENAME READASCII           ASCII>LIST  CHANGED? OFF                 HOME-PAGE ;                                                                                                                                                   \   FEATURES ……                12APR92PZ                                          ‹ : BACKUP-FILE ( GA NAME -- )                OVER 15 BUSOUT                           " S0:/" COUNT BUSTYPE                    DUP COUNT BUSTYPE BUSOFF                 SWAP 15 BUSOUT                           " R0:/" COUNT BUSTYPE                    DUP COUNT BUSTYPE ASCII = BUS!           COUNT BUSTYPE BUSOFF ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \   FEATURES ……                17APR92PZ                                          ‹ : WRITETEXT ( -- )                          " WRITE:" GETFILENAME SCANFILENAME       2DUP FADDR 2!                            OVER 3 PICK BACKUP-FILE                  BUSOPEN COUNT BUSTYPE                    " ,S,W" COUNT BUSTYPE BUSOFF             DERROR? ?EXIT                            FADDR 2@ BUSOUT                          PAGE[ @ ¬≈«…Œ DUP COUNT BUSTYPE                  EOL C@ BUS!  /EOL @ 1-                      …∆ EOL 1+ C@ BUS! ‘»≈Œ                >NEXTLINE DUP ]PAGE @ =                  ’Œ‘…Ã                            BUSOFF  FADDR 2@ BUSCLOSE                DERROR? DROP  CHANGED? OFF ;                                                                                                                                                                                                                                                                                                                                               \   FRAME                      12APR92PZ                                          ‹ EDLOOP EDIT-PAGE                                                                 COPYCHAR NOOP     NOOP     NOOP          DELUNDER READTEXT NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     SPLITLINE NOOP    NOOP          NOOP     DOWN     NOOP     NOOP          DELLEFT' NOOP     NOOP     NOOP          END!     NOOP     NOOP     NOOP          NOOP     RIGHT    COPYLINE NOOP                                                   NOOP     NOOP     NOOP     NOOP          NOOP     INSTLINE PASTELINE PASTECHAR    SCROLLUP DELLINE  CUTLINE  CUTCHAR       SCROLLDOWN NEXTLINE NOOP   NOOP          WRITETEXT UP      SWITCH-EOL CLEARLINE   +-INST   NOOP     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     LEFT     NOOP     RENAMEFILE                                             CR .( EDIT-PAGE OKAY ! ) CR                                                                                              \   FRAME                      01MAY92PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        KKKKKKKKKA                                                                                                                                             EDI†††††††††††††††37†2A††††                                                                                      ˇ                                                                                                                                                                                                                                                              KKKK\ ALLOCATE                     01MAY92PZ                                            1 1 +THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \   ALLOCATE                   01MAY92PZ                                          \ ULTRA∆œ“‘»-SPECIFIC DEFINITION:                                                 ‹ 2048 CONSTANT STACKSIZE                ‹ : HEAPSPACE ( -- N )                        S0 @  HERE -  STACKSIZE UMAX             STACKSIZE - ;                                                                ‹ VARIABLE (EDIT[                        ‹ VARIABLE (]EDIT                        ‹ : EDIT[  (EDIT[ @ ;                    ‹ : ]EDIT  (]EDIT @ ;                                                             ‹ : EDIT[]-ALLOCATE ( -- N )                  HEAP (]EDIT !                            HEAPSPACE DUP HALLOT                     HEAP (EDIT[ ! ;                                                              ‹ : EDIT[]-FREE ( -- )                        HEAP EDIT[ =                                …∆ EDIT[ ]EDIT - HALLOT ≈Ã”≈             ." EDITOR CAN'T RELEASE MEMORY"          ‘»≈Œ ;                                                                   KKKKKKKKKKKKKKKK\ FRAME                        01MAY92PZ                                           1 3 +THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \   FRAME                      18APR92PZ                                          ‹ EDLOOP EDIT-PAGE                                                                 COPYCHAR NOOP     SCROLLDOWN NOOP        DELUNDER WRITETEXT NOOP    NOOP          NOOP     NOOP     NOOP     KILLTEXT      NOOP     SPLITLINE SCROLLUP HOME-LINE    END-LINE DOWN     NOOP     HOME-PAGE     DELLEFT' NOOP     NOOP     NOOP          END!     NOOP     NOOP     NOOP          RENAMEFILE RIGHT  COPYLINE SWITCHTEXT                                             NOOP     NOOP     NOOP     NOOP          NOOP     INSTLINE PASTELINE PASTECHAR    HTAB>    DELLINE  CUTLINE  CUTCHAR       <HTAB    NEXTLINE CLEARLINE NOOP         READTEXT UP       SWITCH-EOL END-PAGE    +-INST   NOOP     NOOP     NOOP          NOOP     NOOP     NOOP     NOOP          NOOP     LEFT     NOOP     NOOP                                                   CR .( EDIT-PAGE OKAY ! ) CR                                                                                              \   FRAME                      01MAY92PZ                                          ‹ VARIABLE ANY-CHANGED?                                                           ‹ : SHOW-UNSAVED ( -- )                       ANY-CHANGED? OFF  TEXT#@  PAD 0          " UNSAVED TEXTS: " STRMEMCAT             #TEXTS 1 ƒœ … TEXT#!  CHANGED? @            …∆ … [ ASCII 0  BL 256 * + ]             LITERAL + OVER 3 PICK + !  2+            ANY-CHANGED? ON ‘»≈Œ                  Ãœœ–                                     ANY-CHANGED? @                              …∆ 1- .MSG ≈Ã”≈ 2DROP ‘»≈Œ            TEXT#! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                     \   FRAME                      01MAY92PZ                                          ‹ : PEDDI ( -- )                              EDIT[]-ALLOCATE  1000 U< …∆              ." TOO LITTLE MEMORY FOR EDITOR"         EXIT ‘»≈Œ                                                                         INIT-MEM  INIT-DISPLAY  SET-EOL          1 SWITCH2TEXT#  .LOGO                                                             ¬≈«…Œ EDIT-PAGE SHOW-UNSAVED             " EXIT? (Y/N)" COUNT .MSG                KEY ASCII Y =                               DUP 0= …∆ .CANCEL ‘»≈Œ                ’Œ‘…Ã                                                                             PAGE EDIT[]-FREE ;                                                                                                                                                                                                                                                                                                                                                         \ CHECK-MEM                    13SEP94PZ                                            : CHECK-MEM  ( -- )                         LINE> @ 1ST-LINE> @ LAST-LINE> @         1+ UWITHIN NOT                              …∆ WARN-SIGNAL 1 1060 C! ‘»≈Œ    \    )TEXT @ 1ST-LINE> @ LAST-LINE> @    \    1+ UWITHIN NOT                      \       …∆ WARN-SIGNAL 2 1061 C! ‘»≈Œ    \    TEXT( @ 1ST-LINE> @ LAST-LINE> @    \    1+ UWITHIN NOT                      \       …∆ WARN-SIGNAL 3 1062 C! ‘»≈Œ         1ST-LINE> @   24 BLANKLINES @ ƒœ         >NEXTLINE Ãœœ– LAST-LINE> @ = 0=            …∆ WARN-SIGNAL 4 1063 C! ‘»≈Œ         )TEXT @ LINE> @ TEXT( @                  UWITHIN NOT                                 …∆ WARN-SIGNAL 5 1059 C! ‘»≈Œ         LINE> @ >NEXTLINE TEXT( @ -                 …∆ WARN-SIGNAL 6 1058 C! ‘»≈Œ      ;                                                                                                                                                                                                         \                              14SEP94PZ                                          ‹ : PR-MEM  ( -- )                          PAGE ." TEXT[ " TEXT[ U. CR              ." 1ST-LINE> " 1ST-LINE> @ U. CR         ." LINE> " LINE> @ U. CR                 ." CHAR> " CHAR>   U. CR                 ." )TEXT " )TEXT @ U. CR                 ." TEXT( " TEXT( @ U. CR                 ." LAST-LINE> " LAST-LINE> @ U. CR       ." ]TEXT " ]TEXT U. CR                   ." BLANKLINES " BLANKLINES @ U. CR       1ST-LINE> @   24 BLANKLINES @ ƒœ         DUP U. ?CR >NEXTLINE Ãœœ– U. CR ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \                              14SEP94PZ                                          ‹ : .INST-LINE ( -- )                         VIR-CHAR OFF   1 MEM? ?EXIT              LINE> @  )TEXT @ OVER - >R               TEXT( @ R@ -  DUP TEXT( !                R> CMOVE>                                )TEXT @ DUP LINE> !  #CR OVER C!         1+ )TEXT !     LAST-LINE-UP              FLIP  CSR.ROW> @ (INST-LINE              FLIP  .VIR-LEFT ;                                                                       …∆ .UP ‘»≈Œ                           CSR.ROW> @ (DEL-LINE                     COL/SCR NEGATE CSR.ROW> +!               BLANKLINES @ 0=                             …∆ LAST-LINE> @ LAST-ROW>                (.LINE ‘»≈Œ                                                                                                                                                                                                                                                                                                                                                14SEP94PZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK\ TRANSIENT ¡SSEMBLER         C09MAY94PZ                                          \NEEDS CODE  1 +LOAD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ ∆ORTH-6502 ¡SSEMBLER        C18JUN94PZ                                          \ ¬ASIS: ∆ORTH ƒIMENSIONS ÷œÃ ……… ŒO. 5)                                          \ INTERNAL LOADING         04MAY85¬–/RE)                                          HERE   $800 HALLOT  HEAP DP !                                                     œNLYFORTH  ¡SSEMBLER ALSO DEFINITIONS             1 7 +THRU                                                                                                         ' NOOP …S .STATUS                                                                 : .BLK  ( -)                              BLK @ ?DUP …∆  ."  ¬LK " U. ?CR  ‘»≈Œ ;                                          ' .BLK …S .STATUS                                                                                                          DP !                                                                              œNLYFORTH                                                                                                                 \ ∆ORTH-83 6502-¡SSEMBLER      20OCT87RE                                          : END-CODE   CONTEXT 2- @  CONTEXT ! ;                                            √REATE INDEX                             $0909 , $1505 , $0115 , $8011 ,          $8009 , $1ƒ0ƒ , $8019 , $8080 ,          $0080 , $1404 , $8014 , $8080 ,          $8080 , $1√0√ , $801√ , $2√80 ,                                                   ‹ ÷ARIABLE MODE                                                                   : ÕODE:  ( N -)   √REATE C,                ƒOES>  ( -)     C@ MODE ! ;                                                     0   ÕODE: .¡        1    ÕODE: #         2 ‹ ÕODE: MEM       3    ÕODE: ,ÿ        4   ÕODE: ,Ÿ        5    ÕODE: ÿ)        6   ÕODE: )Ÿ       $∆    ÕODE: )                                                                                                                                                                                                                                                              \ UPMODE  CPU                  20OCT87RE                                          ‹ : UPMODE ( ADDR0 F0 - ADDR1 F1)         …∆ MODE @  8 OR MODE !   ‘»≈Œ            1 MODE @  $∆ AND ?DUP …∆                 0 ƒœ  DUP +  Ãœœ– ‘»≈Œ                   OVER 1+ @ AND 0= ;                                                               : CPU  ( 8B -)   √REATE  C,                ƒOES>  ( -)    C@ C, MEM ;                                                       00 CPU BRK $18 CPU CLC $ƒ8 CPU CLD      $58 CPU CLI $¬8 CPU CLV $√¡ CPU DEX      $88 CPU DEY $≈8 CPU INX $√8 CPU INY      $≈¡ CPU NOP $48 CPU PHA $08 CPU PHP      $68 CPU PLA $28 CPU PLP $40 CPU RTI      $60 CPU RTS $38 CPU SEC $∆8 CPU SED      $78 CPU SEI $¡¡ CPU TAX $¡8 CPU TAY      $¬¡ CPU TSX $8¡ CPU TXA $9¡ CPU TXS      $98 CPU TYA                                                                                                                                                                                                                                          \ M/CPU                        20OCT87RE                                          : M/CPU  ( MODE OPCODE -)  √REATE C, ,    ƒOES>                                    DUP 1+ @ $80 AND …∆ $10 MODE +! ‘»≈Œ     OVER $∆∆00 AND UPMODE UPMODE             …∆ MEM TRUE ¡BORT" INVALID" ‘»≈Œ         C@ MODE @ INDEX + C@ + C, MODE @ 7 AND   …∆ MODE @  $∆ AND 7 <                     …∆ C, ≈Ã”≈ , ‘»≈Œ ‘»≈Œ MEM ;                                                    $1√6≈ $60 M/CPU ADC $1√6≈ $20 M/CPU AND  $1√6≈ $√0 M/CPU CMP $1√6≈ $40 M/CPU EOR  $1√6≈ $¡0 M/CPU LDA $1√6≈ $00 M/CPU ORA  $1√6≈ $≈0 M/CPU SBC $1√6√ $80 M/CPU STA  $0ƒ0ƒ $01 M/CPU ASL $0√0√ $√1 M/CPU DEC  $0√0√ $≈1 M/CPU INC $0ƒ0ƒ $41 M/CPU LSR  $0ƒ0ƒ $21 M/CPU ROL $0ƒ0ƒ $61 M/CPU ROR  $0414 $81 M/CPU STX $0486 $≈0 M/CPU CPX  $0486 $√0 M/CPU CPY $1496 $¡2 M/CPU LDX  $0√8≈ $¡0 M/CPU LDY $048√ $80 M/CPU STY  $0480 $14 M/CPU JSR $8480 $40 M/CPU JMP  $0484 $20 M/CPU BIT                                                                                                       \ ¡SSEMBLER CONDITIONALS       20OCT87RE                                          ‹ : RANGE?   ( BRANCH -- BRANCH )         DUP ABS  $7∆ U> ¡BORT" OUT OF RANGE " ;                                          : [[  ( ¬≈«…Œ)  HERE ;                                                            : ?]  ( ’Œ‘…Ã)  C, HERE 1+ - RANGE? C, ;                                          : ?[  ( …∆)     C,  HERE 0 C, ;                                                   : ?[[ ( ◊»…Ã≈)  ?[ SWAP ;                                                         : ]?  ( ‘»≈Œ)   HERE OVER C@  …∆ SWAP !   ≈Ã”≈ OVER 1+ - RANGE? SWAP C! ‘»≈Œ ;                                             : ][  ( ≈Ã”≈)   HERE 1+   1 JMP           SWAP HERE OVER 1+ - RANGE?  SWAP C! ;                                            : ]]  ( ¡«¡…Œ)  JMP ;                                                             : ]]? ( “≈–≈¡‘) JMP ]? ;                                                                                                                                           \ ¡SSEMBLER CONDITIONALS       20OCT87RE                                          $90 √ONSTANT √”     $¬0 √ONSTANT √√      $ƒ0 √ONSTANT 0=     $∆0 √ONSTANT 0<>     $10 √ONSTANT 0<     $30 √ONSTANT 0>=     $50 √ONSTANT ÷”     $70 √ONSTANT ÷√                                               : NOT    $20 [ ∆ORTH ] XOR ;                                                      : BEQ    0<> ?] ;   : BMI   0>= ?] ;     : BNE    0=  ?] ;   : BPL   0<  ?] ;     : BCC    √”  ?] ;   : BVC   ÷”  ?] ;     : BCS    √√  ?] ;   : BVS   ÷√  ?] ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ 2INC/2DEC   WINC/WDEC        20OCT87RE                                          : 2INC  ( ADR -- )                        DUP LDA  CLC  2 # ADC                    DUP STA  √” ?[  SWAP 1+ INC  ]?  ;                                               : 2DEC  ( ADR -- )                        DUP LDA  SEC  2 # SBC                    DUP STA  √√ ?[  SWAP 1+ DEC  ]?  ;                                               : WINC  ( ADR -- )                        DUP INC  0= ?[  SWAP 1+ INC  ]?  ;                                               : WDEC  ( ADR -- )                        DUP LDA  0= ?[  OVER 1+ DEC  ]?  DEC  ;                                          : ;C:                                     RECOVER JSR  END-CODE ]  0 LAST !  0 ;                                                                                                                                                                                                                                                                                                \ ;CODE √ODE CODE>          BP/RE03FEB85                                          œNLYFORTH                                                                         : ¡SSEMBLER                               ¡SSEMBLER   [ ¡SSEMBLER ] MEM ;                                                  : ;√ODE                                   [COMPILE] ƒOES>  -3 ALLOT                [COMPILE] ;      -2 ALLOT   ¡SSEMBLER ; IMMEDIATE                                                                         : √ODE  √REATE HERE DUP 2- ! ¡SSEMBLER ;                                          : >LABEL  ( ADR -)                        HERE ‹ √REATE  IMMEDIATE  SWAP ,         4 HALLOT HEAP 1 AND HALLOT ( 6502-ALIG)  HERE 4 - HEAP  4  CMOVE                  HEAP LAST @ COUNT $1∆ AND + !  DP !       ƒOES>  ( - ADR)   @                      STATE @ …∆  [COMPILE] ÃITERAL  ‘»≈Œ ;                                           : ÃABEL                                   [ ¡SSEMBLER ]  HERE >LABEL ¡SSEMBLER ;                                          KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK\ TEST-INCLUDE                 10SEP94PZ                                          : O1 8 2 BUSOPEN " IO.C,S,R" COUNT         BUSTYPE BUSOFF ;                                                                : O2 8 3 BUSOPEN " BASELIB.H,S,R" COUNT    BUSTYPE BUSOFF ;                                                                : C1 8 2 BUSCLOSE ;                      : C2 8 3 BUSCLOSE ;                                                               : T1  8 2 BUSIN 0 ?ƒœ BUS@ CON! Ãœœ–           BUSOFF ;                                                                    : T2  8 3 BUSIN 0 ?ƒœ BUS@ CON! Ãœœ–           BUSOFF ;                                                                                                                                                                                                                                                                                                                                                                                                           KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK